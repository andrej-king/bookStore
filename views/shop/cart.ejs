<%- include('../includes/header.ejs') %>
<link rel="stylesheet" href="/css/cart.css">
</head>

<body>
<%- include('../includes/navigation.ejs') %>
<main>
    <% if (typeof products != "undefined") { %>
        <% if(products.length > 0) { %>

            <ul class="cart-list">
                <%
                    let totalPrice = 0;
                %>
                <% products.forEach(prod => { %>
                    <%
                        totalPrice += prod.productId.price * prod.qty;
                    %>
                    <li class="cart-list-item">
                        <div class="cart-item">
                            <img class="img-thumbnail-cart" src="<%= prod.productId.imageUrl %>" alt="">
                            <p>
                                <a href="/products/<%= prod.productId._id %>" class="link-info cart-item-title"><%= prod.productId.title %></a>
                                <span class="cart-price"><%= prod.productId.price %> $</span>
                            </p>
                        </div>

                        <div class="no-wrap flex-align-column-right">
                            <%- include('../includes/remove-from-cart.ejs', {product: prod.productId}) %>
                            <div>

                                <%
                                    let iconStatus, lockSendForm;
                                    if (prod.qty > 1) {
                                        iconStatus = 'icon-quantity-active';
                                        lockSendForm = '';
                                    } else {
                                        iconStatus = 'icon-quantity-inactive';
                                        lockSendForm = 'preventDefault(event);';
                                    }
                                %>

                                <form action="/cart-update-qty-item" method="post">
                                    <button class="<%= iconStatus %>" name="quantity_update" value="-1" type="submit"
                                            onclick=<%= lockSendForm %>><span class="icon-minus-circle"></span></button>

                                    <span class="cart-item-quantity"><%= prod.qty %></span>
                                    <button class="icon-quantity-active" name="quantity_update" value="+1"
                                            type="submit"><span class="icon-plus-circle"></span></button>

                                    <input type="hidden" value="<%= prod.productId._id %>" name="productId">
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                </form>
                            </div>
                        </div>
                    </li>
                <% }); %>
            </ul>
            <h2 class="cart__total-price">Total price: <%= totalPrice %> $</h2>

            <div class="centered">
                <form action="/create-order" method="post">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn">Order now</button>
                </form>
            </div>

        <% } else { %>
            <h1>Your cart is empty</h1>
        <% } %>
    <% } else { %>
        <h1>Your cart is empty</h1>
    <% } %>
</main>
<%- include('../includes/footer.ejs') %>